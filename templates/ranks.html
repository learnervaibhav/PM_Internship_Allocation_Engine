{% extends "base.html" %}
{% block content %}
<div class="container animate-fade-in-up">
  <!-- Header Section -->
  <div class="mb-4">
    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
      <div>
        <h2 class="display-6 fw-bold mb-2">Candidate Rankings</h2>
        <p class="text-muted fs-5">{{ internship.Company }} â€¢ {{ internship.Role }}</p>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <a href="{{ url_for('ranks_index') }}" class="btn btn-secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 8px;">
            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2"/>
          </svg>
          Back
        </a>
        <a href="{{ url_for('download_ranks', internship_id=internship.InternshipID) }}" class="btn btn-success">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="margin-right: 8px;">
            <path d="M21 15V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V15M7 10L12 15L17 10M12 15V3" stroke="currentColor" stroke-width="2"/>
          </svg>
          Download CSV
        </a>
      </div>
    </div>
  </div>

  <!-- Stats Summary -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="stats-card">
        <div class="stats-number">{{ candidates|length }}</div>
        <div class="stats-label">Total Candidates</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card">
        <div class="stats-number">{{ '%.3f'|format(candidates[0].score) if candidates else '0' }}</div>
        <div class="stats-label">Top Score</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card">
        <div class="stats-number">{{ candidates|selectattr('Category', 'equalto', 'General')|list|length }}</div>
        <div class="stats-label">General Category</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stats-card">
        <div class="stats-number">{{ candidates|selectattr('Tier', 'equalto', 'T1')|list|length }}</div>
        <div class="stats-label">Tier 1 Colleges</div>
      </div>
    </div>
  </div>

  <!-- Rankings Table -->
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0" style="display: flex; align-items: center;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="margin-right: 8px; color: var(--primary-blue);">
          <path d="M12 2L15.09 8.26L22 9L15.09 9.74L12 22L8.91 9.74L2 9L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2"/>
        </svg>
        Candidate Rankings
      </h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th style="width: 80px;"># Rank</th>
              <th>Candidate</th>
              <th style="width: 120px;">AI Score</th>
              <th>Skills</th>
              <th style="width: 80px;">Tier</th>
              <th style="width: 100px;">Category</th>
            </tr>
          </thead>
          <tbody>
            {% for c in candidates %}
              <tr>
                <td>
                  <div style="display: flex; align-items: center;">
                    {% if loop.index <= 3 %}
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="margin-right: 8px; color: {% if loop.index == 1 %}#FFD700{% elif loop.index == 2 %}#C0C0C0{% else %}#CD7F32{% endif %};">
                        <path d="M12 2L15.09 8.26L22 9L15.09 9.74L12 22L8.91 9.74L2 9L8.91 8.26L12 2Z" fill="currentColor"/>
                      </svg>
                    {% endif %}
                    <span class="fw-bold">{{ loop.index }}</span>
                  </div>
                </td>
                <td>
                  <div>
                    <div class="fw-semibold">{{ c.Name }}</div>
                    <small class="text-muted">{{ c.ApplicantID }}</small>
                  </div>
                </td>
                <td>
                  <span class="badge" style="background: linear-gradient(45deg, var(--primary-blue), #5856D6); color: white; font-size: 0.85rem; padding: 0.5rem 0.75rem;">
                    {{ '%.3f'|format(c.score) }}
                  </span>
                </td>
                <td>
                  <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    {{ c.Skills }}
                  </div>
                </td>
                <td>
                  <span class="badge {% if c.Tier == 'T1' %}bg-success{% elif c.Tier == 'T2' %}bg-warning{% else %}bg-secondary{% endif %}">
                    {{ c.Tier }}
                  </span>
                </td>
                <td>
                  <span class="badge bg-light text-dark">{{ c.Category }}</span>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  {% if not candidates %}
  <div class="text-center py-5">
    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="color: var(--text-tertiary); margin-bottom: 1rem;">
      <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
      <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2"/>
    </svg>
    <h5 class="text-muted">No candidates found</h5>
    <p class="text-muted">No candidates match the criteria for this internship opportunity.</p>
  </div>
  {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add smooth animations to table rows
  const rows = document.querySelectorAll('tbody tr');
  rows.forEach((row, index) => {
    row.style.animationDelay = `${index * 0.05}s`;
    row.classList.add('animate-fade-in-up');
  });
});
</script>
{% endblock %}
